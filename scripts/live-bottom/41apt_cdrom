#!/bin/sh

#set -e

# initramfs-tools header

PREREQ=""

prereqs()
{
	echo "${PREREQ}"
}

case "${1}" in
	prereqs)
		prereqs
		exit 0
		;;
esac

# live-boot header

if [ -n "${NOAPTCDROM}" ]
then
	exit 0
fi

. /scripts/live-functions

log_begin_msg "Adding APT-CDROM source"

# live-boot script

if [ -d /root/cdrom ]
then
	mount -n -o bind /sys /root/sys
	mount -n -o bind /proc /root/proc
	mount -n -o bind /dev /root/dev

	chroot /root apt-cdrom -o Acquire::cdrom::AutoDetect=false -m add

	umount /root/dev
	umount /root/proc
	umount /root/sys
fi

log_end_msg
